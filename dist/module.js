var d={INIT:"antetype.init",CLOSE:"antetype.close",DRAW:"antetype.draw",CALC:"antetype.calc",RECALC_FINISHED:"antetype.recalc.finished",MODULES:"antetype.modules",SETTINGS:"antetype.settings.definition",TYPE_DEFINITION:"antetype.layer.type.definition",FONTS_LOADED:"antetype.font.loaded"};function p({herald:y,modules:a,canvas:o}){let n=[],r=[],i=e=>{if(e.ctrlKey){if(e.key==="z"){s();return}if(e.key==="y"){c();return}}},m=e=>{let t=[];return e.forEach(u=>{t.push({instance:u,original:a.core.clone.getOriginal(u.layer)})}),t},l=e=>{n.push(m(e)),r=[],n.length>100&&n.shift()},s=async()=>{if(n.length===0)return;let e=n.splice(-1)[0];r.push(e),await a.core.view.recalculate();for(let t of e)await t.instance.undo(t.original,t.instance.data??void 0);a.core.view.redraw()},c=async()=>{if(r.length===0)return;let e=r.splice(-1)[0];n.push(e),await a.core.view.recalculate();for(let t of e)await t.instance.redo(t.original,t.instance.data??void 0);a.core.view.redraw()};o?.addEventListener("keyup",i,!1);let f=y.batch([{event:"antetype.memento.save",subscription:e=>{l(e.detail.state)}},{event:d.CLOSE,subscription:()=>{o?.removeEventListener("keyup",i,!1),f()}}]);return{addToStack:l,undo:s,redo:c}}export{p as default};
