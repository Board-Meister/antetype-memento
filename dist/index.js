var p=(e=>(e.SAVE="antetype.memento.save",e))(p||{});var s={INIT:"antetype.init",CLOSE:"antetype.close",DRAW:"antetype.draw",CALC:"antetype.calc",RECALC_FINISHED:"antetype.recalc.finished",MODULES:"antetype.modules",SETTINGS:"antetype.settings.definition",TYPE_DEFINITION:"antetype.layer.type.definition",FONTS_LOADED:"antetype.font.loaded"};var b="core",w="0.0.5",C=class{#e;#t=null;#r=null;static inject={marshal:"boardmeister/marshal",herald:"boardmeister/herald"};inject(a){this.#e=a}async loadModules(a,e){return(await this.#n()).loadModules(a,e)}register(a){let{registration:e}=a.detail;e[b]={load:async()=>(this.#t??=(await this.#a("core.js")).default,(o,r)=>this.#t({canvas:r,modules:o,herald:this.#e.herald})),version:w}}static subscriptions={[s.MODULES]:"register"};#a(a){return import(this.#e.marshal.getResourceUrl(this,a))}async#n(){return this.#r??=(await this.#a("helper.js")).default,new this.#r(this.#e.herald)}};function h({herald:a,modules:e,canvas:o}){let r=[],i=[],l=t=>{if(t.ctrlKey){if(t.key==="z"){d();return}if(t.key==="y"){u();return}}},g=t=>{let n=[];return t.forEach(m=>{n.push({instance:m,original:e.core.clone.getOriginal(m.layer)})}),n},c=t=>{r.push(g(t)),i=[],r.length>100&&r.shift()},d=async()=>{if(r.length===0)return;let t=r.splice(-1)[0];i.push(t),await e.core.view.recalculate();for(let n of t)await n.instance.undo(n.original,n.instance.data??void 0);e.core.view.redraw()},u=async()=>{if(i.length===0)return;let t=i.splice(-1)[0];r.push(t),await e.core.view.recalculate();for(let n of t)await n.instance.redo(n.original,n.instance.data??void 0);e.core.view.redraw()};o?.addEventListener("keyup",l,!1);let v=a.batch([{event:"antetype.memento.save",subscription:t=>{c(t.detail.state)}},{event:s.CLOSE,subscription:()=>{o?.removeEventListener("keyup",l,!1),v()}}]);return{addToStack:c,undo:d,redo:u}}var f="memento",I="0.0.4",y=class{#e;#t=null;static inject={marshal:"boardmeister/marshal",herald:"boardmeister/herald"};inject(e){this.#e=e}register(e){let{registration:o}=e.detail;o[f]={load:async()=>{if(!this.#t){let r=this.#e.marshal.getResourceUrl(this,"module.js");this.#t=(await import(r)).default}return(r,i)=>this.#t({canvas:i,modules:r,herald:this.#e.herald})},version:I}}static subscriptions={[s.MODULES]:"register"}};export{p as Event,f as ID,h as Memento,I as VERSION};
