var d=(n=>(n.SAVE="antetype.memento.save",n))(d||{});var p={INIT:"antetype.init",CLOSE:"antetype.close",DRAW:"antetype.draw",CALC:"antetype.calc",RECALC_FINISHED:"antetype.recalc.finished",MODULES:"antetype.modules",SETTINGS:"antetype.settings.definition",TYPE_DEFINITION:"antetype.layer.type.definition",FONTS_LOADED:"antetype.font.loaded"};function y({herald:m,modules:n,canvas:o}){let a=[],r=[],i=e=>{if(e.ctrlKey){if(e.key==="z"){s();return}if(e.key==="y"){c();return}}},f=e=>{let t=[];return e.forEach(u=>{t.push({instance:u,original:n.core.clone.getOriginal(u.layer)})}),t},l=e=>{a.push(f(e)),r=[],a.length>100&&a.shift()},s=async()=>{if(a.length===0)return;let e=a.splice(-1)[0];r.push(e),await n.core.view.recalculate();for(let t of e)await t.instance.undo(t.original,t.instance.data??void 0);n.core.view.redraw()},c=async()=>{if(r.length===0)return;let e=r.splice(-1)[0];a.push(e),await n.core.view.recalculate();for(let t of e)await t.instance.redo(t.original,t.instance.data??void 0);n.core.view.redraw()};o?.addEventListener("keyup",i,!1);let h=m.batch([{event:"antetype.memento.save",subscription:e=>{l(e.detail.state)}},{event:p.CLOSE,subscription:()=>{o?.removeEventListener("keyup",i,!1),h()}}]);return{addToStack:l,undo:s,redo:c}}export{d as Event,y as Memento};
